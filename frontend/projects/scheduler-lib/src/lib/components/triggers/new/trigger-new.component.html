<div class="trigger-pop">
  <mat-card>
    <mat-card-header class="space-btw">
      <mat-card-title>{{ translationService.instant('TRIGGERS.NEW.TITLE') }}</mat-card-title>
      <a href="javascript:void(0)" (click)="onCancel()" class="cancle-btn"><i class="material-icons">close</i></a>
    </mat-card-header>
    <mat-card-content>
      <form [formGroup]="triggerForm" #jobNgForm="ngForm" (ngSubmit)="onSubmit()" class="trigger-form">
        
        <!-- Step 1: Select Trigger Type -->
        <div class="step-section">
          <label class="step-label">Step 1: Select Trigger Type</label>
          <mat-radio-group name="type" formControlName="triggerType" class="trigger-type">
            <div class="radio-option">
              <mat-radio-button value="Simple">Simple</mat-radio-button>
              <mat-icon matTooltip="{{ translationService.instant('TRIGGERS.FIELDS.SIMPLE-TYPE-HELP') }}" class="help-icon">help_outline</mat-icon>
            </div>
            <div class="radio-option">
              <mat-radio-button value="Cron">Cron</mat-radio-button>
              <mat-icon matTooltip="{{ translationService.instant('TRIGGERS.FIELDS.CRON-TYPE-HELP') }}" class="help-icon">help_outline</mat-icon>
            </div>
          </mat-radio-group>
        </div>

        <!-- Step 2: Select a Job -->
        <div class="step-section">
          <label class="step-label">Step 2: Select a Job</label>
          <button mat-raised-button color="accent" title="select-job" (click)="selectJob()" class="select-job-btn">
            {{ translationService.instant('TRIGGERS.ACTIONS.SELECT-JOB') }}
          </button>
          <div class="job-fields">
            <div class="fc-col-md-6">
              <mat-form-field class="full-width">
                <mat-label>{{ translationService.instant('TRIGGERS.FIELDS.JOB-NAME') }}</mat-label>
                <input
                  formControlName="jobName"
                  matInput
                  [placeholder]="translationService.instant('TRIGGERS.FIELDS.JOB-NAME')"
                />
                <mat-error *ngIf="!triggerForm?.get('jobName')?.valid && triggerForm?.get('jobName')?.touched">
                  {{ translationService.instant('SCHEDULER-GENERAL.ERRORS.REQUIRED') }}
                </mat-error>
              </mat-form-field>
            </div>
            <div class="fc-col-md-6">
              <mat-form-field class="full-width">
                <mat-label>{{ translationService.instant('TRIGGERS.FIELDS.JOB-GROUP') }}</mat-label>
                <input
                  formControlName="jobGroup"
                  matInput
                  [placeholder]="translationService.instant('TRIGGERS.FIELDS.JOB-GROUP')"
                />
                <mat-error *ngIf="!triggerForm?.get('jobGroup')?.valid && triggerForm?.get('jobGroup')?.touched">
                  {{ translationService.instant('SCHEDULER-GENERAL.ERRORS.REQUIRED') }}
                </mat-error>
              </mat-form-field>
            </div>
          </div>
        </div>

        <!-- Step 3: Fill trigger details -->
        <div class="step-section">
          <label class="step-label">Step 3: Fill trigger details</label>
          
          <!-- Basic Trigger Info -->
          <div class="trigger-details-row">
            <div class="fc-col-md-6">
              <mat-form-field class="full-width">
                <mat-label>
                  {{ translationService.instant('TRIGGERS.FIELDS.NAME') }}
                  <mat-icon matTooltip="{{ translationService.instant('TRIGGERS.FIELDS.NAME-HELP') }}" class="help-icon">help_outline</mat-icon>
                </mat-label>
                <input formControlName="triggerName" matInput />
                <mat-error *ngIf="!triggerForm?.get('triggerName')?.valid && triggerForm?.get('triggerName')?.touched">
                  {{ translationService.instant('SCHEDULER-GENERAL.ERRORS.REQUIRED') }}
                </mat-error>
              </mat-form-field>
            </div>
            <div class="fc-col-md-6">
              <mat-form-field class="full-width">
                <mat-label>
                  {{ translationService.instant('TRIGGERS.FIELDS.GROUP') }}
                  <mat-icon matTooltip="{{ translationService.instant('TRIGGERS.FIELDS.GROUP-HELP') }}" class="help-icon">help_outline</mat-icon>
                </mat-label>
                <input formControlName="triggerGroup" matInput [matAutocomplete]="auto" />
                <mat-autocomplete #auto="matAutocomplete">
                  <mat-option *ngFor="let group of filteredOptions | async" [value]="group">
                    {{ group }}
                  </mat-option>
                </mat-autocomplete>
                <mat-error *ngIf="!triggerForm?.get('triggerGroup')?.valid && triggerForm?.get('triggerGroup')?.touched">
                  {{ translationService.instant('SCHEDULER-GENERAL.ERRORS.REQUIRED') }}
                </mat-error>
              </mat-form-field>
            </div>
          </div>

          <!-- Start Date/Time -->
          <div class="trigger-details-row">
            <div class="fc-col-md-6">
              <mat-form-field class="full-width">
                <mat-label>
                  {{ translationService.instant('TRIGGERS.FIELDS.START-DATE') }}
                  <mat-icon matTooltip="{{ translationService.instant('TRIGGERS.FIELDS.START-DATE-HELP') }}" class="help-icon">help_outline</mat-icon>
                </mat-label>
                <input matInput [matDatepicker]="startDatePicker" formControlName="startDate" />
                <mat-datepicker-toggle matSuffix [for]="startDatePicker"></mat-datepicker-toggle>
                <mat-datepicker #startDatePicker></mat-datepicker>
                <mat-error *ngIf="!triggerForm?.get('startDate')?.valid && triggerForm?.get('startDate')?.touched">
                </mat-error>
              </mat-form-field>
            </div>
            <div class="fc-col-md-6">
              <mat-form-field class="full-width">
                <mat-label>
                  {{ translationService.instant('TRIGGERS.FIELDS.START-TIME') }}
                  <mat-icon matTooltip="{{ translationService.instant('TRIGGERS.FIELDS.START-TIME-HELP') }}" class="help-icon">help_outline</mat-icon>
                </mat-label>
                <input type="time" formControlName="startTime" matInput />
                <mat-error *ngIf="!triggerForm?.get('startTime')?.valid && triggerForm?.get('startTime')?.touched">
                  {{ translationService.instant('SCHEDULER-GENERAL.ERRORS.REQUIRED') }}
                </mat-error>
              </mat-form-field>
            </div>
          </div>

          <!-- End Date/Time -->
          <div class="trigger-details-row">
            <div class="fc-col-md-6">
              <mat-form-field class="full-width">
                <mat-label>
                  {{ translationService.instant('TRIGGERS.FIELDS.END-DATE') }}
                  <mat-icon matTooltip="{{ translationService.instant('TRIGGERS.FIELDS.END-DATE-HELP') }}" class="help-icon">help_outline</mat-icon>
                </mat-label>
                <input matInput [matDatepicker]="endDatePicker" formControlName="endDate" />
                <mat-datepicker-toggle matSuffix [for]="endDatePicker"></mat-datepicker-toggle>
                <mat-datepicker #endDatePicker></mat-datepicker>
                <mat-error *ngIf="!triggerForm?.get('endDate')?.valid && triggerForm?.get('endDate')?.touched"></mat-error>
              </mat-form-field>
            </div>
            <div class="fc-col-md-6">
              <mat-form-field class="full-width">
                <mat-label>
                  {{ translationService.instant('TRIGGERS.FIELDS.END-TIME') }}
                  <mat-icon matTooltip="{{ translationService.instant('TRIGGERS.FIELDS.END-TIME-HELP') }}" class="help-icon">help_outline</mat-icon>
                </mat-label>
                <input type="time" formControlName="endTime" matInput />
                <mat-error *ngIf="!triggerForm?.get('endTime')?.valid && triggerForm?.get('endTime')?.touched">
                  {{ translationService.instant('SCHEDULER-GENERAL.ERRORS.REQUIRED') }}
                </mat-error>
              </mat-form-field>
            </div>
          </div>

          <!-- Cron Expression (for Cron triggers) -->
          <div class="trigger-details-row" [hidden]="triggerForm?.get('triggerType')?.value !== triggerTypes[1]">
            <div class="fc-col-md-6">
              <mat-form-field class="full-width">
                <mat-label>
                  {{ translationService.instant('TRIGGERS.FIELDS.CRON-EXPRESSION') }}
                  <mat-icon matTooltip="{{ translationService.instant('TRIGGERS.FIELDS.CRON-EXPRESSION-HELP') }}" class="help-icon">help_outline</mat-icon>
                </mat-label>
                <input formControlName="cronExpression" matInput />
                <mat-error *ngIf="!triggerForm?.get('cronExpression')?.valid && triggerForm?.get('cronExpression')?.touched">
                  {{ translationService.instant('SCHEDULER-GENERAL.ERRORS.REQUIRED') }}
                </mat-error>
              </mat-form-field>
            </div>
          </div>

          <!-- Repeat Interval (for Simple triggers) -->
          <div class="trigger-details-row" [hidden]="triggerForm?.get('triggerType')?.value === triggerTypes[1]">
            <div class="fc-col-md-6">
              <mat-form-field class="full-width">
                <mat-label>
                  {{ translationService.instant('TRIGGERS.FIELDS.REPEAT-INTERVAL') }}
                  <mat-icon matTooltip="{{ translationService.instant('TRIGGERS.FIELDS.REPEAT-INTERVAL-HELP') }}" class="help-icon">help_outline</mat-icon>
                </mat-label>
                <input type="number" formControlName="repeatInterval" matInput />
                <mat-error *ngIf="!triggerForm?.get('repeatInterval')?.valid && triggerForm?.get('repeatInterval')?.touched">
                  {{ translationService.instant('SCHEDULER-GENERAL.ERRORS.REQUIRED') }}
                </mat-error>
              </mat-form-field>
            </div>
          </div>

          <!-- Repeat Indefinitely (for Simple triggers) -->
          <div class="trigger-details-row" [hidden]="triggerForm?.get('triggerType')?.value === triggerTypes[1]">
            <div class="fc-col-md-6">
              <div class="checkbox-container">
                <mat-checkbox formControlName="repeatIndefinite">
                  {{ translationService.instant('TRIGGERS.FIELDS.REPEAT-INDEFINITELY') }}
                  <mat-icon matTooltip="{{ translationService.instant('TRIGGERS.FIELDS.REPEAT-INDEFINITELY-HELP') }}" class="help-icon">help_outline</mat-icon>
                </mat-checkbox>
              </div>
            </div>
          </div>

          <!-- Repeat Count (for Simple triggers when not indefinite) -->
          <div class="trigger-details-row" 
               [hidden]="triggerForm?.get('triggerType')?.value === triggerTypes[1] || triggerForm?.get('repeatIndefinite')?.value">
            <div class="fc-col-md-6">
              <mat-form-field class="full-width">
                <mat-label>
                  {{ translationService.instant('TRIGGERS.FIELDS.REPEAT-COUNT') }}
                  <mat-icon matTooltip="{{ translationService.instant('TRIGGERS.FIELDS.REPEAT-COUNT-HELP') }}" class="help-icon">help_outline</mat-icon>
                </mat-label>
                <input type="number" formControlName="repeatCount" matInput />
                <mat-error *ngIf="!triggerForm?.get('repeatCount')?.valid && triggerForm?.get('repeatCount')?.touched">
                  {{ translationService.instant('SCHEDULER-GENERAL.ERRORS.REQUIRED') }}
                </mat-error>
              </mat-form-field>
            </div>
          </div>

          <!-- Description -->
          <div class="trigger-details-row">
            <div class="fc-col-md-6">
              <mat-form-field class="full-width">
                <mat-label>
                  {{ translationService.instant('TRIGGERS.FIELDS.DESCRIPTION') }}
                  <mat-icon matTooltip="{{ translationService.instant('TRIGGERS.FIELDS.DESCRIPTION-HELP') }}" class="help-icon">help_outline</mat-icon>
                </mat-label>
                <textarea formControlName="description" matInput></textarea>
                <mat-error *ngIf="!triggerForm?.get('description')?.valid && triggerForm?.get('description')?.touched">
                  {{ translationService.instant('SCHEDULER-GENERAL.ERRORS.LENGTH-EXCEDDING', { length: 80 }) }}
                </mat-error>
              </mat-form-field>
            </div>
          </div>
        </div>

        <!-- Job Data Section -->
        <div class="job-data-section">
          <div class="job-data-header">
            <label class="job-data-label">
              {{ translationService.instant('TRIGGERS.FIELDS.JOB-MAP-DATA') }}
              <mat-icon matTooltip="{{ translationService.instant('TRIGGERS.FIELDS.JOB-MAP-DATA-HELP') }}" class="help-icon">help_outline</mat-icon>
            </label>
            <mat-icon (click)="addJobData()" class="add-icon">add_circle</mat-icon>
          </div>
          <mat-table [dataSource]="dataSource" class="job-data-table">
            <ng-container matColumnDef="position">
              <th mat-header-cell *matHeaderCellDef>{{ translationService.instant('JOB-DATA.KEY') }}</th>
              <td mat-cell *matCellDef="let element">
                <input
                  matInput
                  [(ngModel)]="element.dataKey"
                  [ngModelOptions]="{ standalone: true }"
                  placeholder="Enter key name"
                />
              </td>
            </ng-container>

            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef>{{ translationService.instant('JOB-DATA.VALUE') }}</th>
              <td mat-cell *matCellDef="let element">
                <input
                  matInput
                  [(ngModel)]="element.dataValue"
                  [ngModelOptions]="{ standalone: true }"
                  placeholder="Enter value"
                />
              </td>
            </ng-container>

            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef>{{ translationService.instant('SCHEDULER-GENERAL.ACTIONS.ACTIONS') }}</th>
              <td mat-cell *matCellDef="let element; let i = index" class="fc-text-center">
                <mat-icon (click)="removeJobData(i)" class="remove-icon">remove_circle</mat-icon>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
          </mat-table>
        </div>

      </form>
    </mat-card-content>
    <mat-card-actions class="fc-text-right">
      <button
        color="primary"
        mat-raised-button
        name="save"
        (click)="jobNgForm.ngSubmit.emit()"
        [disabled]="!triggerForm?.valid || loading()"
      >
        {{ translationService.instant('SCHEDULER-GENERAL.ACTIONS.SAVE') }}
      </button>
    </mat-card-actions>
  </mat-card>
</div>
